# Human-in-the-loop 中断确认机制

## 1. 关键预订确认点
在各个预订代理执行前或执行后中断，让用户确认预订信息：

### 航班预订确认
当系统找到合适的航班时，在预订前中断，让用户确认航班信息

### 酒店预订确认
当系统找到合适的酒店时，在预订前中断，让用户确认酒店信息

### 火车票预订确认
当系统找到合适的火车票时，在预订前中断，让用户确认车次信息

### 租车预订确认
当系统找到合适的车辆时，在预订前中断，让用户确认车辆信息

## 2. 推荐确认点
在 recommendation_agent 提供推荐后中断，让用户确认推荐方案：

## 3. 通用确认模式

### 确认工具
使用通用确认工具 `generic_confirmation` 来处理所有需要用户确认的操作。

### 检查点机制
所有关键操作都会通过以下方式持久化：
- `_persist_to_mongodb`: 持久化到MongoDB
- `_persist_to_postgresql`: 持久化到PostgreSQL
- `_persist_complete_conversation`: 持久化完整会话记录

### 实现方式
1. 在执行关键操作前调用确认工具
2. 用户确认后继续执行操作
3. 操作完成后保存检查点